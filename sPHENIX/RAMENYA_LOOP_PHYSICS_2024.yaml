#________________________________________________________________________________________________________DST_PHYSICS__
#
PHYS_DST_STREAMING_EVENT_run2pp:

   params:
     name:       DST_STREAMING_EVENT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p002
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_cosmics.sh
     payload :   ./slurp-examples/sPHENIX/cosmics/
     mem     :   20480MB
     neventsper: 1000
     comment :    "---"
     rsync   : "./slurp-examples/sPHENIX/cosmics/*,cups.py,bachi.py,odbc.ini"
   input:
      db: daqdb
      direct_path: /sphenix/lustre01/sphnxpro/{mode}/*/physics/
      query: |-
         with partialrun as (
         select 'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  

         from filelist
         where 
           ( 
             (filename  like '/bbox%/TPC%physics%-0000.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/TPOT%physics%-0000.evt'  and lastevent>2 ) or
             (filename  like '/bbox%/physics_intt%-0000.evt'  and lastevent>2 ) or
             (filename  like '/bbox%/GL1_physics%-0000.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/physics_mvtx%-0000.evt'  and lastevent>2 )
           )
                {run_condition}
              and runnumber<=53880

         group by runnumber
         having
                every(transferred_to_sdcc)   and
                max(lastevent)>1000          and
                sum( case when filename like '/bbox%/GL1_physics%' then 1 else 0 end )>0 and
                (
                   sum( case when filename like '/bbox%/TPC%physics%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/TPOT%physics%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/physics%intt%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/physics_mvtx%.evt' then 1 else 0 end )>0 
                )
         order by runnumber
         ), 
         fullrun as (
         select 
                'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  
         from  
                filelist
         where 
           ( 
             (filename  like '/bbox%/TPC%physics%.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/TPOT%physics%.evt'  and lastevent>2 ) or
             (filename  like '/bbox%/physics_intt%.evt'  and lastevent>2 ) or
             (filename  like '/bbox%/GL1_physics%.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/physics_mvtx%.evt'  and lastevent>2 )
           )
                {run_condition}
              and runnumber<=53880

         group by runnumber
         having
                every(transferred_to_sdcc)   and
                max(lastevent)>1000          and
                sum( case when filename like '/bbox%/GL1_physics%' then 1 else 0 end )>0 and
                (
                   sum( case when filename like '/bbox%/TPC%physics%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/TPOT%physics%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/physics%intt%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/physics_mvtx%.evt' then 1 else 0 end )>0 
                )
         order by runnumber
         )

         select *,'partial run' as runtype from partialrun where runnumber not in ( select runnumber from fullrun )             and runnumber<=53880
              union all 
         select *,'full run' as runtype from fullrun where true            and runnumber<=53880

              ;

   # TODO:  Need to add error checking to make sure that outdir, logdir, etc... are quoted properly.  Else, this will cause problems with argument substitution
   filesystem:  
     outdir  : "/sphenix/lustre01/sphnxpro/physics/slurp/streaming/physics/$(build)_$(tag)/run_$(rungroup)"
     logdir  : "file:///sphenix/data/data02/sphnxpro/streaminglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/streamhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/testlogs/$(build)_$(tag)/run_$(rungroup)"

   #
   # Again I note the need to ensure that the arguments are properly specified given the
   # definition of the payload script.
   #
   job:
     executable            : "{payload}/run_cosmics.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {neventsper} {logdir} {comment} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '4000'
     request_xferslots: '0'



#_______________________________________________________________________________________________________DST_EVENT__
#
# kaedama.py --rule DST_EVENT --config examples/sPHENIX/DST_EVENT_aua23.yaml --runs ...
#
DST_TPCCALIB:

   params:
     name:       DST_TPC_EVENT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p002
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_cosmics.sh
     payload :   ./slurp-examples/sPHENIX/cosmics/
     mem     :   2048MB
     neventsper: 50000
     mem     :   16384MB
     rsync   : "./slurp-examples/sPHENIX/cosmics/*,cups.py,bachi.py,odbc.ini"

   #
   # input query:
   #
   # This builds a list of all runs known to the file catalog "datasets" table.
   # The query should return:
   # 1. The source of the information (formatted as database name/table name)
   # 2. The run number
   # 3. A sequence number (a placeholder fixed at zero for event builders)
   # 4. And a space-separated list of logical filenames 
   #
   # The {*_condition} parameters (run, seg, limit) are substituted by kaedama
   # based on (optional) command line options.
   #
   input:
      db: daqdb
      direct_path: /sphenix/lustre01/sphnxpro/{mode}/tpc/calib/
      query: |-
         select 
                'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  
         from  
                filelist
         where 
                filename     like '/bbox%/TPC%calib%.evt'
                {run_condition}

              and runnumber<=53880

         group by runnumber
         having
                every(transferred_to_sdcc)                                            
         order by runnumber
                {limit_condition}
              ;              

   # TODO:  Need to add error checking to make sure that outdir, logdir, etc... are quoted properly.  Else, this will cause problems with argument substitution
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/streaming/calib/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/streaming/caliblogs/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/testlogs/$(build)_$(tag)/run_$(rungroup)"

   #
   # Again I note the need to ensure that the arguments are properly specified given the
   # definition of the payload script.
   #
   job:
     executable            : "{payload}/run_cosmics.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {neventsper} {logdir} TPCCALIB {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'


DST_INTT_EVENT:

   # At the moment, an extra _ in here will throw off cups b/c it parses out 
   # run, build, dsttype, etc... from the output filename... so DST_PHYSICS_run1aua
   # will need to wait...
   params:
     name:       DST_INTT_EVENT_physics
     build:      new
     build_name: new
     dbtag:      2024p002
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_cosmics.sh
     payload :   ./slurp-examples/sPHENIX/cosmics/
     mem     :   8192MB
     neventsper: 500000
     rsync   : "./slurp-examples/sPHENIX/cosmics/*,cups.py,bachi.py,odbc.ini"

   #
   # input query:
   #
   # This builds a list of all runs known to the file catalog "datasets" table.
   # The query should return:
   # 1. The source of the information (formatted as database name/table name)
   # 2. The run number
   # 3. A sequence number (a placeholder fixed at zero for event builders)
   # 4. And a space-separated list of logical filenames 
   #
   # The {*_condition} parameters (run, seg, limit) are substituted by kaedama
   # based on (optional) command line options.
   #
   # For now, require GL1 files...
   #             (filename  like '/bbox%/physics_mvtx%.evt'  and lastevent>2 )
   #               sum( case when filename like '/bbox%/physics%mvtx%' then 1 else 0 end )>0 
   #
   input:
      db: daqdb
      direct_path: /sphenix/lustre01/sphnxpro/{mode}/*/physics/
      query: |-
         select 
                'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  
         from  
                filelist
         where 
           ( 
             (filename  like '/bbox%/TPOT%physics%.evt'  and lastevent>2 ) or
             (filename  like '/bbox%/physics_intt%.evt'  and lastevent>2 ) or
             (filename  like '/bbox%/GL1_physics%'       and lastevent>2 ) or
             (filename  like '/bbox%/physics_mvtx%.evt'  and lastevent>2 )
           )
                {run_condition}
           and runnumber>=35590
           and runnumber<=53880

         group by runnumber
         having
                every(transferred_to_sdcc)   and
                max(lastevent)>1000          and
                sum( case when filename like '/bbox%/GL1_physics%' then 1 else 0 end )>0 and
                (
                   sum( case when filename like '/bbox%/TPOT%physics%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/physics%intt%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/physics_mvtx%.evt' then 1 else 0 end )>0 
                )
         order by runnumber
                {limit_condition}
              ;              

   # TODO:  Need to add error checking to make sure that outdir, logdir, etc... are quoted properly.  Else, this will cause problems with argument substitution
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/inttphysics/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/testlogs/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/testlogs/$(build)_$(tag)/run_$(rungroup)"

   #
   # Again I note the need to ensure that the arguments are properly specified given the
   # definition of the payload script.
   #
   job:
     executable            : "{payload}/run_cosmics.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {neventsper} {logdir} INTT {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'
     request_xferslots: '0'




DST_TRKR_HIT_SET_physics:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_HIT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p004
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_STREAMING_EVENT_run2pp_new_2024p002%'
                {run_condition}
                and runnumber<=48098
                and runnumber<=53880
         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/hitsethist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'






#_________________________________________________________________________________________________________________________________________
DST_TRKR_CLUSTER_SET_run2pp:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_CLUSTER_run2pp
     build:      new
     build_name: new
     dbtag:      2024p004
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_job0.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :  0
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_TRKR_HIT_run2pp_new_2024p004%'
                {run_condition}
                and runnumber<=48098
                and runnumber<=53880
         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/clusterhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_job0.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'




#_________________________________________________________________________________________________________________________________________
DST_TRKR_SEED_SET_run2pp:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_SEED_run2pp
     build:      new
     build_name: new
     dbtag:      2024p004
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_jobA.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :  0
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p004%'
                {run_condition}
                and runnumber<=48098
                and runnumber<=53880
         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/seedhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_jobA.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'


DST_TRKR_TRACKS_SET_run2pp:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_TRACKS_run2pp
     build:      new
     build_name: new
     dbtag:      2024p004
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_jobC.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :   0
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"



   input:
      db: fc
      query: |-
         select
               'filecatalog/datasets'   as source       ,
               runnumber                                ,
               segment                                  ,
               string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
               string_agg( distinct split_part(filename,'/',-1) || ':' || 0 || ':' || -1, ' ' )    as fileranges  
         from
               datasets
         where
           ( 
              filename like 'DST_TRKR_SEED_run2pp_new_2024p004%' or
              filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p004%' 
           )
           {run_condition}
           and runnumber<=48098
           and runnumber<=53880

         group by runnumber,segment 

         having (

            sum( case when filename like 'DST_TRKR_SEED_run2pp_new_2024p004%' then 1 else 0 end )>0    and
            sum( case when filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p004%' then 1 else 0 end )>0 

         )

         order by runnumber
 
         {limit_condition}
         ;
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs//$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/trackhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_jobC.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'








#________________________________________________________________________________________________________________________________________________
DST_TRKR_HIT_SET_physics_2024p005:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_HIT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p005
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_STREAMING_EVENT_run2pp_new_2024p002%'
                {run_condition}
                and runnumber>48098 and runnumber<49910
                and runnumber<=53880

         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/hitsethist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrogs/run_$(rungroup)"

   job:
     executable            : "{payload}/run.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'



#_________________________________________________________________________________________________________________________________________
DST_TRKR_CLUSTER_SET_run2pp_2024p005:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_CLUSTER_run2pp
     build:      new
     build_name: new
     dbtag:      2024p005
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_job0.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :  0
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_TRKR_HIT_run2pp_new_2024p005%'
                {run_condition}
                and runnumber>48098
                and runnumber<=53880

         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/clusterhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/run_$(rungroup)"

   job:
     executable            : "{payload}/run_job0.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'


#_________________________________________________________________________________________________________________________________________
DST_TRKR_SEED_SET_run2pp_2024p005:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_SEED_run2pp
     build:      new
     build_name: new
     dbtag:      2024p005
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_jobA.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :  0

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p005%'
                {run_condition}
                and runnumber>48098
                and runnumber<=53880
         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/seedhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/$(build)_$(tag)/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_jobA.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'







DST_TRKR_TRACKS_SET_run2pp_2024p005:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_TRACKS_run2pp
     build:      new
     build_name: new
     dbtag:      2024p005
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_jobC.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :   0
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select
               'filecatalog/datasets'   as source       ,
               runnumber                                ,
               segment                                  ,
               string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
               string_agg( distinct split_part(filename,'/',-1) || ':' || 0 || ':' || -1, ' ' )    as fileranges  
         from
               datasets
         where
           ( 
              filename like 'DST_TRKR_SEED_run2pp_new_2024p005%' or
              filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p005%' 
           )
           {run_condition}
                and runnumber>48098
                and runnumber<=53880

         group by runnumber,segment 

         having (

            sum( case when filename like 'DST_TRKR_SEED_run2pp_new_2024p005%' then 1 else 0 end )>0    and
            sum( case when filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p005%' then 1 else 0 end )>0 

         )

         order by runnumber
 
         {limit_condition}
         ;
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/trackhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_jobC.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'





#_______________________________________________________________________________________________________________________________________________
DST_TRKR_HIT_SET_physics_2024p007:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_HIT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p007
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_STREAMING_EVENT_run2pp_new_2024p002%'
                {run_condition}
                and runnumber>=49700
                and runnumber<=53880
         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/hitsethist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'



#_________________________________________________________________________________________________________________________________________
DST_TRKR_CLUSTER_SET_run2pp_2024p007:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_CLUSTER_run2pp
     build:      new
     build_name: new
     dbtag:      2024p007
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_job0.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :  0
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_TRKR_HIT_run2pp_new_2024p007%'
                {run_condition}
                and runnumber>=49700
                and runnumber<=53880
         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/clusterhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_job0.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'



#_________________________________________________________________________________________________________________________________________
DST_TRKR_SEED_SET_run2pp_2024p007:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_SEED_run2pp
     build:      new
     build_name: new
     dbtag:      2024p007
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_jobA.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :  0
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select 
                'filecatalog/datasets'   as source       ,
                runnumber                                ,
                segment                                  ,
                filename                    as files     ,
                filename || ':0:' || events as fileranges
         from  
                datasets
         where
                filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p007%'
                {run_condition}
                and runnumber>=49700
                and runnumber<=53880
         order by runnumber
                {limit_condition}
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/seedhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_jobA.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'




DST_TRKR_TRACKS_SET_run2pp_2024p007:
   # DST_EVENT works from a pre-built set of run lists.
   params:
     name:       DST_TRKR_TRACKS_run2pp
     build:      new
     build_name: new
     dbtag:      2024p007
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_jobC.sh
     payload :   ./slurp-examples/sPHENIX/TrackingProduction/
     mem     :   2048MB
     nevents :   0
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: fc
      query: |-
         select
               'filecatalog/datasets'   as source       ,
               runnumber                                ,
               segment                                  ,
               string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
               string_agg( distinct split_part(filename,'/',-1) || ':' || 0 || ':' || -1, ' ' )    as fileranges  
         from
               datasets
         where
           ( 
              filename like 'DST_TRKR_SEED_run2pp_new_2024p007%' or
              filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p007%' 
           )
           {run_condition}
                and runnumber>=49700
                and runnumber<=53880

         group by runnumber,segment 

         having (

            sum( case when filename like 'DST_TRKR_SEED_run2pp_new_2024p007%' then 1 else 0 end )>0    and
            sum( case when filename like 'DST_TRKR_CLUSTER_run2pp_new_2024p007%' then 1 else 0 end )>0 

         )

         order by runnumber
 
         {limit_condition}
         ;
              ;              
   filesystem:  
     outdir : "/sphenix/lustre01/sphnxpro/physics/slurp/tracking/$(build)_$(tag)/run_$(rungroup)"
     logdir : "file:///sphenix/data/data02/sphnxpro/trackinglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/trackhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/trkrlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_jobC.sh"
     arguments             : "{nevents} {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {logdir} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'














#________________________________________________________________________________________________________DST_PHYSICS__
#
PHYS_DST_STREAMING_EVENT_run2pp_nomvtx:

   params:
     name:       DST_STREAMING_EVENT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p002
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_cosmics.sh
     payload :   ./slurp-examples/sPHENIX/cosmics/
     mem     :   4096MB
#    mem     :   16384MB
     neventsper: 2500
     comment:    "---"
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: daqdb
      direct_path: /sphenix/lustre01/sphnxpro/{mode}/*/physics/
      query: |-
         select 
                'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  
         from  
                filelist
         where 
           ( 
             (filename  like '/bbox%/TPC%physics%.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/TPOT%physics%.evt'  and lastevent>2 ) or
             (filename  like '/bbox%/physics_intt%.evt'  and lastevent>2 ) or
             (filename  like '/bbox%/GL1_physics%'       and lastevent>2 )
           )
                {run_condition}
              and runnumber<=53880

         group by runnumber
         having
                every(transferred_to_sdcc)   and
                max(lastevent)>1000          and
                sum( case when filename like '/bbox%/GL1_physics%' then 1 else 0 end )>0 and
                (
                   sum( case when filename like '/bbox%/TPC%physics%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/TPOT%physics%' then 1 else 0 end )>0 or
                   sum( case when filename like '/bbox%/physics%intt%' then 1 else 0 end )>0 
                )
         order by runnumber
                {limit_condition}
              ;

   # TODO:  Need to add error checking to make sure that outdir, logdir, etc... are quoted properly.  Else, this will cause problems with argument substitution
   filesystem:  
     outdir  : "/sphenix/lustre01/sphnxpro/physics/slurp/streaming/physics/$(build)_$(tag)/run_$(rungroup)"
     logdir  : "file:///sphenix/data/data02/sphnxpro/streaminglogs/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/streamhist/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/testlogs/$(build)_$(tag)/run_$(rungroup)"

   #
   # Again I note the need to ensure that the arguments are properly specified given the
   # definition of the payload script.
   #
   job:
     executable            : "{payload}/run_cosmics.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {neventsper} {logdir} {comment} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'
     request_xferslots: '0'



#_______________________________________________________________________________________________________________________________________________________
PHYS_DST_TPC_EVENT_run2pp:
   params:
     name:       DST_TPC_EVENT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p002
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_cosmics.sh
     payload :   ./slurp-examples/sPHENIX/cosmics/
     mem     :   4096MB
     neventsper: 2500
     comment:    "---"
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: daqdb
      direct_path: /sphenix/lustre01/sphnxpro/{mode}/*/physics/
      query: |-
         select 
                'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  
         from  
                filelist
         where 
           ( 
             (filename  like '/bbox%/TPC%physics%.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/GL1_physics%'       and lastevent>2 ) 
           )
         {run_condition}
              and runnumber<=53880

         group by runnumber
         having
                every(transferred_to_sdcc)   and
                max(lastevent)>1000          and
                sum( case when filename like '/bbox%/GL1_physics%' then 1 else 0 end )>0 and
                sum( case when filename like '/bbox%/TPC%physics%' then 1 else 0 end )>0 
         order by runnumber                
         {limit_condition};

   filesystem:  
     outdir  : "/sphenix/lustre01/sphnxpro/physics/slurp/streaming/physics/tpconly/$(build)_$(tag)/run_$(rungroup)"
     logdir  : "file:///sphenix/data/data02/sphnxpro/streaminglogs/tpconly/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/streamhist/tpconly/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/testlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_cosmics.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {neventsper} {logdir} {comment} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'
     request_xferslots: '0'


#_______________________________________________________________________________________________________________________________________________________
PHYS_DST_TPOT_EVENT_run2pp:
   params:
     name:       DST_TPOT_EVENT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p002
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_cosmics.sh
     payload :   ./slurp-examples/sPHENIX/cosmics/
     mem     :   4096MB
     neventsper: 2500
     comment:    "---"
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: daqdb
      direct_path: /sphenix/lustre01/sphnxpro/{mode}/*/physics/
      query: |-
         select 
                'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  
         from  
                filelist
         where 
           ( 
             (filename  like '/bbox%/TPOT%physics%.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/GL1_physics%'       and lastevent>2 )
           )
         {run_condition}
              and runnumber<=53880
         group by runnumber
         having
                every(transferred_to_sdcc)   and
                max(lastevent)>1000          and
                sum( case when filename like '/bbox%/GL1_physics%' then 1 else 0 end )>0 and
                sum( case when filename like '/bbox%/TPOT%physics%' then 1 else 0 end )>0 
         order by runnumber                
         {limit_condition};
   filesystem:  
     outdir  : "/sphenix/lustre01/sphnxpro/physics/slurp/streaming/physics/tpotonly/$(build)_$(tag)/run_$(rungroup)"
     logdir  : "file:///sphenix/data/data02/sphnxpro/streaminglogs/tpotonly/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/streamhist/tpotonly/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/testlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_cosmics.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {neventsper} {logdir} {comment} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'
     request_xferslots: '0'



#_______________________________________________________________________________________________________________________________________________________
PHYS_DST_INTT_EVENT_run2pp:
   params:
     name:       DST_INTT_EVENT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p002
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_cosmics.sh
     payload :   ./slurp-examples/sPHENIX/cosmics/
     mem     :   4096MB
     neventsper: 2500
     comment:    "---"
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"
   input:
      db: daqdb
      direct_path: /sphenix/lustre01/sphnxpro/{mode}/*/physics/
      query: |-
         select 
                'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  
         from  
                filelist
         where 
           ( 
             (filename  like '/bbox%/physics_intt%.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/GL1_physics%'       and lastevent>2 ) 
           )
         {run_condition}
              and runnumber<=53880
         group by runnumber
         having
                every(transferred_to_sdcc)   and
                max(lastevent)>1000          and
                sum( case when filename like '/bbox%/GL1_physics%' then 1 else 0 end )>0 and
                sum( case when filename like '/bbox%/physics_intt%' then 1 else 0 end )>0 
         order by runnumber                
         {limit_condition};
   filesystem:  
     outdir  : "/sphenix/lustre01/sphnxpro/physics/slurp/streaming/physics/inttonly/$(build)_$(tag)/run_$(rungroup)"
     logdir  : "file:///sphenix/data/data02/sphnxpro/streaminglogs/inttonly/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/streamhist/inttonly/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/testlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_cosmics.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {neventsper} {logdir} {comment} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'
     request_xferslots: '0'




#_______________________________________________________________________________________________________________________________________________________
PHYS_DST_MVTX_EVENT_run2pp:
   params:
     name:       DST_MVTX_EVENT_run2pp
     build:      new
     build_name: new
     dbtag:      2024p002
     logbase :   $(name)_$(build)_$(tag)-$INT(run,{RUNFMT})-$INT(seg,{SEGFMT})
     outbase :   $(name)_$(build)_$(tag)
     script  :   run_cosmics.sh
     payload :   ./slurp-examples/sPHENIX/cosmics/
     mem     :   4096MB
     neventsper: 2500
     comment:    "---"
     rsync   : "./slurp-examples/sPHENIX/TrackingProduction/*,cups.py,bachi.py,odbc.ini"

   input:
      db: daqdb
      direct_path: /sphenix/lustre01/sphnxpro/{mode}/*/physics/
      query: |-
         select 
                'daqdb/filelist'                                                                                    as source      , 
                runnumber                                                                                                          , 
                0                                                                                                   as segment     , 
                string_agg( distinct split_part(filename,'/',-1), ' ' )                                             as files       ,   
                string_agg( distinct split_part(filename,'/',-1) || ':' || firstevent || ':' || lastevent, ' ' )    as fileranges  
         from  
                filelist
         where 
           ( 
             (filename  like '/bbox%/physics_mvtx%.evt'   and lastevent>2 ) or
             (filename  like '/bbox%/GL1_physics%'       and lastevent>2 ) 
           )
         {run_condition}
              and runnumber<=53880
         group by runnumber
         having
                every(transferred_to_sdcc)   and
                max(lastevent)>1000          and
                sum( case when filename like '/bbox%/GL1_physics%' then 1 else 0 end )>0 and
                sum( case when filename like '/bbox%/physics_mvtx%' then 1 else 0 end )>0 
         order by runnumber                
         {limit_condition};
   filesystem:  
     outdir  : "/sphenix/lustre01/sphnxpro/physics/slurp/streaming/physics/mvtxonly/$(build)_$(tag)/run_$(rungroup)"
     logdir  : "file:///sphenix/data/data02/sphnxpro/streaminglogs/mvtxonly/$(build)_$(tag)/run_$(rungroup)"
     histdir :       "/sphenix/data/data02/sphnxpro/streamhist/mvtxonly/$(build)_$(tag)/run_$(rungroup)"
     condor :        "/tmp/testlogs/$(build)_$(tag)/run_$(rungroup)"

   job:
     executable            : "{payload}/run_cosmics.sh"
     arguments             : "$(nevents) {outbase} {logbase} $(run) $(seg) {outdir} $(build) $(tag) $(inputs) $(ranges) {neventsper} {logdir} {comment} {histdir} {PWD} {rsync}"
     output_destination    : '{logdir}'
     log                   : '{condor}/{logbase}.condor'
     accounting_group      : "group_sphenix.mdc2"
     accounting_group_user : "sphnxpro"
     priority : '3800'
     request_xferslots: '0'


